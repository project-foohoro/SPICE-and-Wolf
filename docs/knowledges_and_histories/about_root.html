<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>有关 root 的二三事 | SPICE and Wolf （暂定）</title>
    <meta name="generator" content="VuePress 1.5.0">
    
    <meta name="description" content="Just playing around">
    <link rel="preload" href="/SPICE-and-Wolf/assets/css/0.styles.bd531b56.css" as="style"><link rel="preload" href="/SPICE-and-Wolf/assets/js/app.df0453c9.js" as="script"><link rel="preload" href="/SPICE-and-Wolf/assets/js/2.e2add5c1.js" as="script"><link rel="preload" href="/SPICE-and-Wolf/assets/js/32.cf5db7e1.js" as="script"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/10.d48b972b.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/11.94c4045f.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/12.1f900929.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/13.62625e7a.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/14.cc9292b5.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/15.bdcd8b23.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/16.1b84bc00.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/17.53272452.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/18.98a2b058.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/19.2ac84ad9.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/20.0e215edb.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/21.e2ed72e5.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/22.ef8861f5.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/23.53697ca9.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/24.0cb215a0.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/25.4cb81419.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/26.80bfc3f6.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/27.66c3808e.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/28.5118da9d.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/29.e734e2aa.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/3.cbd1593f.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/30.76668803.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/31.d5d58f77.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/33.7f6898a4.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/34.7de85ed5.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/35.d7e8dbe1.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/36.20210079.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/37.6634ae82.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/38.304a051f.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/39.f89ec55a.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/4.05d2b28f.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/40.4e340873.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/41.d26b5970.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/42.e2695be2.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/43.723cc31d.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/44.8e41a1db.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/45.ff921a62.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/46.04559bcb.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/5.62367596.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/6.89965624.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/7.8178534b.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/8.6b54dfb2.js"><link rel="prefetch" href="/SPICE-and-Wolf/assets/js/9.053d3169.js">
    <link rel="stylesheet" href="/SPICE-and-Wolf/assets/css/0.styles.bd531b56.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/SPICE-and-Wolf/" class="home-link router-link-active"><!----> <span class="site-name">SPICE and Wolf （暂定）</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/SPICE-and-Wolf/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/SPICE-and-Wolf/knowledges_and_histories/.html#" class="nav-link">
  Placeholder
</a></div> <a href="https://github.com/project-wolves/SPICE-and-Wolf" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/SPICE-and-Wolf/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/SPICE-and-Wolf/knowledges_and_histories/.html#" class="nav-link">
  Placeholder
</a></div> <a href="https://github.com/project-wolves/SPICE-and-Wolf" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/SPICE-and-Wolf/" class="sidebar-heading clickable router-link-active open"><span>首页</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/SPICE-and-Wolf/plans.html" class="sidebar-link">规划中目录</a></li><li><a href="/SPICE-and-Wolf/drafts/" class="sidebar-link">施工中页面</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>总次</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/SPICE-and-Wolf/knowledges_and_histories/" aria-current="page" class="sidebar-link">科普和史话</a></li><li><a href="/SPICE-and-Wolf/experiences_from_writers/" class="sidebar-link">编者经验谈</a></li><li><a href="/SPICE-and-Wolf/install_arch_linux/" class="sidebar-link">安装 Arch Linux</a></li><li><a href="/SPICE-and-Wolf/softwares/" class="sidebar-link">使用各种软件</a></li><li><a href="/SPICE-and-Wolf/basic_usage/" class="sidebar-link">基本使用</a></li><li><a href="/SPICE-and-Wolf/troubleshooting/" class="sidebar-link">故障排除</a></li><li><a href="/SPICE-and-Wolf/virtualbox_install_and_usage/" class="sidebar-link">附录：安装和设置 VirtualBox</a></li><li><a href="/SPICE-and-Wolf/further_reading/" class="sidebar-link">前方的路</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="有关-root-的二三事"><a href="#有关-root-的二三事" class="header-anchor">#</a> 有关 root 的二三事</h1> <p>相信大部分人对“root 权限”的认识，是从 Android 开始的。大多数人的印象大概是：root 权限是一个非常高也非常危险的权限，使用这个权限的时候，一不小心就会把系统搞坏。</p> <p>前半句没错，后半句——GNU/Linux（尤其是给桌面用户用的那些发行版），在这方面还是比较友好的。</p> <h2 id="什么是-root-权限？"><a href="#什么是-root-权限？" class="header-anchor">#</a> 什么是 root 权限？</h2> <p>这里的 root 权限，实际上指的是名为 root 的账户所具有的权限。“获取 root 权限”，指的实际是获取 root 账户的使用权。root 是系统中权限最高的用户。和 Windows 的 Administrator 相比，权限不知道高到哪里去了。（<em>注：在 Windows 中想获取较高的权限，可以使用 NSudo</em>）举个例子：Administrator 是删除不了 <code>explorer.exe</code> 文件的，而 root 可以删除你当前正在使用的 shell 。</p> <h2 id="切换到-root-账户"><a href="#切换到-root-账户" class="header-anchor">#</a> 切换到 root 账户</h2> <p>使用命令 <code>su</code> 。</p> <p>Android 上的软件，实际上就是这样获取你授予它的 root 权限的。当然，会有一定的验证措施。在手机上通常是弹框确认，而在电脑上，通常会要求用户输入 root 账户的密码。</p> <h2 id="我不知道-root-账户的密码，怎么办？"><a href="#我不知道-root-账户的密码，怎么办？" class="header-anchor">#</a> 我不知道 root 账户的密码，怎么办？</h2> <p>在许多桌面发行版（如 Ubuntu Desktop）中，root 账户默认是不被用户直接接触的。如 Ubuntu，其 root 账户默认是被禁用的。在这种情况下，用户通过 <code>sudo</code> 命令获取 root 账户的使用权。</p> <p>对 <code>sudo apt-get ...</code> 不陌生吧？对，这就是 <code>sudo</code> 的用法了。<strong>注意</strong>，在使用 <code>sudo</code> 的时候，它询问的是<strong>你自己账户的密码</strong>，而不是 root 账户的密码。</p> <p>想切换到 root 权限的 shell？也用这样的方法， <code>sudo -i</code></p> <h2 id="sudo-可以让任何人使用-root-账户？那岂不是太不安全了！"><a href="#sudo-可以让任何人使用-root-账户？那岂不是太不安全了！" class="header-anchor">#</a> sudo 可以让任何人使用 root 账户？那岂不是太不安全了！</h2> <p>并不是的呢。 sudo 君有一个小名单，只有名单上的人才可以使用 sudo。这个名单就是 <code>/etc/sudoers</code> 。</p> <p>在 Redhat 系统上，很多人在使用 sudo 时会发现这样的提示：</p> <blockquote><p>用户不在 sudoers 文件中。此事将被报告。</p></blockquote> <p>为什么呢？ Redhat 系的发行版，似乎不默认把安装时建立的用户加入 sudoer，sudo 君自然就不会放行啦。</p> <p>如想编辑 <code>/etc/sudoers</code> ，建议使用 <code>visudo</code>。</p> <h3 id="etc-sudoers"><a href="#etc-sudoers" class="header-anchor">#</a> /etc/sudoers</h3> <p>sudo 的配置文件是 <code>/etc/sudoers</code> 。visudo会锁住 sudoers 文件，保存修改到临时文件，然后检查文件格式，确保正确后才会覆盖 sudoers 文件。必须保证 sudoers 格式正确，否则 sudo 将无法运行。</p> <div class="language-text extra-class"><pre class="language-text"><code># visudo
</code></pre></div><p>看名字就知道它会用 vi 啦，如果汝想换一个自己喜欢的编辑器的话，可以用 <code>EDITOR</code> 环境变量设置：</p> <div class="language-text extra-class"><pre class="language-text"><code># EDITOR=vim visudo
</code></pre></div><h3 id="wheel-组"><a href="#wheel-组" class="header-anchor">#</a> wheel 组</h3> <p>很多系统在 <code>/etc/sudoers</code> 都有这条预置策略： <code>wheel</code> 组的所有成员都可以使用 <code>sudo</code>。所以，如果想让一位用户使用 <code>sudo</code>，最简单的方法就是将此用户加入<code>wheel</code>组：</p> <div class="language-text extra-class"><pre class="language-text"><code># usermod -G (追加用户到组) {组名} {用户名}
usermod -G wheel &lt;用户名&gt;
# gpasswd 也有类似的作用
gpasswd -a &lt;用户名&gt; wheel
</code></pre></div><h3 id="编辑-sudoers-文件"><a href="#编辑-sudoers-文件" class="header-anchor">#</a> 编辑 sudoers 文件</h3> <div class="language-text extra-class"><pre class="language-text"><code>## sudoers file.
##
## This file MUST be edited with the 'visudo' command as root.
## Failure to use 'visudo' may result in syntax or file permission errors
## that prevent sudo from running.
##
## See the sudoers man page for the details on how to write a sudoers file.
##

##
## Host alias specification
## 主机名别名
## Groups of machines. These may include host names (optionally with wildcards),
## IP addresses, network numbers or netgroups.
# Host_Alias    WEBSERVERS = www1, www2, www3

##
## User alias specification
## 用户别名
## Groups of users.  These may consist of user names, uids, Unix groups,
## or netgroups.
# User_Alias    ADMINS = millert, dowdy, mikef

##
## Cmnd alias specification
## 命令别名
## Groups of commands.  Often used to group related commands together.
# Cmnd_Alias    PROCESSES = /usr/bin/nice, /bin/kill, /usr/bin/renice, \
#                 /usr/bin/pkill, /usr/bin/top
# Cmnd_Alias    REBOOT = /sbin/halt, /sbin/reboot, /sbin/poweroff

##
## Defaults specification
## 默认参数（例如保持各种环境变量等等，按需取消注释即可）
## You may wish to keep some of the following environment variables
## when running commands via sudo.
##
## Locale settings
# Defaults env_keep += &quot;LANG LANGUAGE LINGUAS LC_* _XKB_CHARSET&quot;
##
## Run X applications through sudo; HOME is used to find the
## .Xauthority file.  Note that other programs use HOME to find   
## configuration files and this may lead to privilege escalation!
# Defaults env_keep += &quot;HOME&quot;
##
## X11 resource path settings
# Defaults env_keep += &quot;XAPPLRESDIR XFILESEARCHPATH XUSERFILESEARCHPATH&quot;
##
## Desktop path settings
# Defaults env_keep += &quot;QTDIR KDEDIR&quot;
##
## Allow sudo-run commands to inherit the callers' ConsoleKit session
# Defaults env_keep += &quot;XDG_SESSION_COOKIE&quot;
##
## Uncomment to enable special input methods.  Care should be taken as
## this may allow users to subvert the command being run via sudo.
# Defaults env_keep += &quot;XMODIFIERS GTK_IM_MODULE QT_IM_MODULE QT_IM_SWITCHER&quot;
##
## Uncomment to use a hard-coded PATH instead of the user's to find commands
# Defaults secure_path=&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;
##
## Uncomment to send mail if the user does not enter the correct password.
# Defaults mail_badpass
##
## Uncomment to enable logging of a command's output, except for
## sudoreplay and reboot.  Use sudoreplay to play back logged sessions.
# Defaults log_output
# Defaults!/usr/bin/sudoreplay !log_output
# Defaults!/usr/local/bin/sudoreplay !log_output
# Defaults!REBOOT !log_output

##
## Runas alias specification
##

##
## User privilege specification
##
## 按用户分配权限。
## 用户名 主机名 = 命令
root ALL=(ALL) ALL

## 要为某个用户可以执行所有命令，在配置文件中加入：
## 用户名   ALL=(ALL) ALL

## 如果只想允许以某个主机名登录用户执行命令：
## 用户名   主机名=(ALL) ALL

## 允许wheel用户组成员无密码使用sudo：
## %wheel      ALL=(ALL) NOPASSWD: ALL

## 要不询问某个用户的密码:
## Defaults:USER_NAME      !authenticate

## 只为用户启用部分命令的执行权限：
## 用户名 主机名=/sbin/halt,/sbin/poweroff,/sbin/reboot,/usr/bin/pacman -Syu

## 按组分配权限
## Uncomment to allow members of group wheel to execute any command
%wheel ALL=(ALL) ALL

## 如果希望不需要密码使用 sudo
## Same thing without a password
# %wheel ALL=(ALL) NOPASSWD: ALL

## Uncomment to allow members of group sudo to execute any command
# %sudo    ALL=(ALL) ALL

## Uncomment to allow any user to run sudo if they know the password
## of the user they are running the command as (root by default).
# Defaults targetpw  # Ask for the password of the target user
# ALL ALL=(ALL) ALL  # WARNING: only use this together with 'Defaults targetpw'

## 从 /etc/sudoers.d/ 中读取追加设置（这里的 # 不是注释）
## Read drop-in files from /etc/sudoers.d
## (the '#' here does not indicate a comment)
#includedir /etc/sudoers.d
</code></pre></div><p>更多的设置范例可以参考 <a href="http://www.gratisoft.us/sudo/man/sudoers.html" target="_blank" rel="noopener noreferrer">sudo 用户手册<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="su-和-sudo-怎么拿到-root-权限的？"><a href="#su-和-sudo-怎么拿到-root-权限的？" class="header-anchor">#</a> su 和 sudo 怎么拿到 root 权限的？</h2> <p>让我们看一看 <code>ls -l /bin/su</code> 和 <code>ls -l /usr/bin/sudo</code> 的权限：</p> <div class="language-text extra-class"><pre class="language-text"><code>-rwsr-xr-x 1 root root （其后省略）
</code></pre></div><p>这里的小写字母 s 是一个有点特殊的权限：SUID。通俗地说，拥有这个权限的可执行程序，在运行时会拥有其所有者的权限（即 Set UID），于是 <code>su</code> 和 <code>sudo</code> 就得到了 root 权限（当然，不一定会给所有调用它们的人）。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/project-wolves/SPICE-and-Wolf/edit/master/knowledges_and_histories/about_root.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页面</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/SPICE-and-Wolf/assets/js/app.df0453c9.js" defer></script><script src="/SPICE-and-Wolf/assets/js/2.e2add5c1.js" defer></script><script src="/SPICE-and-Wolf/assets/js/32.cf5db7e1.js" defer></script>
  </body>
</html>
